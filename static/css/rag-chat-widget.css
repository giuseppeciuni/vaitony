/* rag-chat-widget.css
   Re-implementazione UI ispirata a Telegram / WhatsApp
   - bolle chiaramente distinte (utente a destra, bot a sinistra)
   - input sempre visibile su iOS/Android (visualViewport handling + JS)
   - fullscreen mobile, safe-area aware
   - nessun codice di debug
*/

/* ---------- VARIABILI ---------- */
:root{
  --rag-primary: #00A884;            /* verde-telegram/wa */
  --rag-primary-600: #008d72;
  --rag-bg: #ffffff;
  --rag-surface: #f5f7f9;
  --rag-user-bubble: #DCF8C6;        /* WA-like user bubble */
  --rag-bot-bubble: #FFFFFF;
  --rag-text: #0f1720;
  --rag-muted: #6b7280;
  --rag-border: rgba(15,23,32,0.06);
  --rag-radius: 18px;
  --rag-radius-small: 8px;
  --rag-shadow: 0 6px 22px rgba(2,6,23,0.12);
  --rag-header-h: 60px;
  --rag-input-h: 64px;
  --rag-width: 370px;
  --rag-bubble-size: 62px;
  --rag-safe-bottom: env(safe-area-inset-bottom, 0px);
  --vh: 1vh; /* JS aggiorna --vh dinamicamente per mobile  */
}

/* ---------- RESET e basici ---------- */
#rag-chat-widget, #rag-chat-widget * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
#rag-chat-widget { position: fixed; right: 20px; bottom: 20px; z-index: 999999; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }

/* ---------- FLOATING BUBBLE ---------- */
#rag-chat-bubble {
  width: var(--rag-bubble-size); height: var(--rag-bubble-size);
  border-radius: 50%;
  background: linear-gradient(135deg,var(--rag-primary),var(--rag-primary-600));
  display:flex; align-items:center; justify-content:center;
  color: white; cursor:pointer; box-shadow: var(--rag-shadow);
  border: 3px solid white;
  transition: transform .14s ease, box-shadow .14s ease;
}
#rag-chat-bubble:active { transform: scale(.96); }
#rag-chat-bubble .rag-notification { position:absolute; top:-6px; right:-6px; min-width:18px; height:18px; padding:0 5px; border-radius:12px; background:#ff3b30; color:white; font-size:11px; display:none; align-items:center; justify-content:center; }

/* ---------- CHAT WINDOW ---------- */
#rag-chat-window {
  position: absolute; right: 0; bottom: calc(var(--rag-bubble-size) + 12px);
  width: var(--rag-width); max-width: calc(100vw - 36px);
  height: calc(var(--vh,1vh) * 100 - 40px);
  max-height: 90vh;
  background: var(--rag-bg);
  border-radius: 14px;
  box-shadow: var(--rag-shadow);
  border: 1px solid var(--rag-border);
  display: none;
  flex-direction: column;
  overflow: hidden;
}

/* ---------- HEADER (look: Telegram/WA) ---------- */
.rag-chat-header {
  display:flex; align-items:center; gap:12px;
  padding: 10px 14px; height: var(--rag-header-h); min-height: var(--rag-header-h);
  background: linear-gradient(90deg, rgba(0,168,132,0.98), rgba(0,141,114,0.98));
  color: #fff;
}
.rag-bot-avatar { width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;flex-shrink:0; }
.rag-header-info { min-width:0; overflow:hidden; display:flex; flex-direction:column; }
.rag-header-title { font-weight:600; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.rag-header-sub { font-size:12px; opacity:.9; color:rgba(255,255,255,0.9); }

/* close button */
.rag-close-btn { margin-left: auto; background:none; border:0; color:inherit; cursor:pointer; padding:8px; display:flex; align-items:center; justify-content:center; border-radius:10px; }
.rag-close-btn:focus { outline:2px solid rgba(255,255,255,0.18); outline-offset:2px; }

/* ---------- MESSAGES AREA ---------- */
.rag-chat-messages {
  padding: 12px; overflow-y:auto; -webkit-overflow-scrolling:touch;
  background: linear-gradient(180deg, var(--rag-surface) 0%, #f1f4f7 100%);
  flex:1; display:flex; flex-direction:column; gap:10px;
  scroll-behavior: smooth;
}

/* message items */
.rag-message { max-width:85%; word-wrap:break-word; overflow-wrap:break-word; display:inline-flex; flex-direction:column; gap:6px; }
.rag-message .rag-text { font-size:14px; line-height:1.46; color:var(--rag-text); padding:10px 12px; border-radius:12px; box-shadow: 0 1px 2px rgba(2,6,23,0.04); }
.rag-message.bot { align-self:flex-start; text-align:left; }
.rag-message.user { align-self:flex-end; text-align:right; }

/* bubble styling */
.rag-message.bot .rag-text { background: var(--rag-bot-bubble); border-radius: 14px 14px 14px 6px; border:1px solid rgba(15,23,32,0.04); }
.rag-message.user .rag-text { background: var(--rag-user-bubble); border-radius: 14px 14px 6px 14px; border:1px solid rgba(0,0,0,0.03); color:var(--rag-text); }

/* timestamp */
.rag-meta { font-size:11px; color:var(--rag-muted); opacity:0.9; }

/* clickable links & sources */
.rag-message .rag-link { color:var(--rag-primary); text-decoration:none; font-weight:600; }

/* typing indicator */
.rag-typing { display:flex; gap:6px; align-items:center; padding:8px 12px; border-radius:14px; background:var(--rag-bot-bubble); border:1px solid rgba(15,23,32,0.04); }
.rag-typing-dot { width:6px;height:6px;background:var(--rag-muted); border-radius:50%; animation: rag-bounce 1.2s infinite; }
.rag-typing-dot:nth-child(2){ animation-delay:.12s } .rag-typing-dot:nth-child(3){ animation-delay:.24s }
@keyframes rag-bounce{ 0%,80%,100%{ transform:scale(.7); opacity:.6 } 40%{ transform:scale(1.2); opacity:1 } }

/* ---------- INPUT AREA ---------- */
.rag-input-container {
  border-top:1px solid var(--rag-border);
  padding: 10px; display:flex; gap:10px; align-items:flex-end; background:var(--rag-bg);
  /* We keep the input container flexible; JS may change to position:fixed on mobile keyboard */
}
.rag-input {
  flex:1; display:flex; gap:8px; align-items:center;
  background: #fff; border-radius: 20px; padding:8px 12px; border:1px solid rgba(0,0,0,0.04);
}
.rag-chat-input {
  flex:1; resize:none; border:0; padding:8px 6px; font-size:15px; line-height:1.3; background:transparent; color:var(--rag-text);
  max-height:140px; min-height:36px; overflow:auto;
}
.rag-chat-input:focus{ outline:none; }
.rag-send-btn {
  background: var(--rag-primary); color:white; border:0; padding:10px 12px; border-radius:12px; cursor:pointer; display:inline-flex; align-items:center; justify-content:center;
  min-width:44px; min-height:44px;
}
.rag-send-btn:disabled { opacity:.5; cursor:not-allowed; transform:none; }

/* branding small */
.rag-branding { font-size:11px; color:var(--rag-muted); text-align:center; padding:6px 0 0 0; }

/* ---------- MOBILE: fullscreen behavior ---------- */
@media (max-width: 768px) {
  #rag-chat-widget { left:0; right:0; bottom:0; top:0; display:block; pointer-events:auto; }
  #rag-chat-bubble { position: fixed; right: 18px; bottom: 18px; z-index: 1000000; }
  #rag-chat-window { position: fixed; right:0; left:0; bottom:0; top:0; width:100vw; height:calc(var(--vh,1vh) * 100); border-radius:0; max-width:none; max-height:none; }
  .rag-chat-header { height: calc(var(--rag-header-h) + var(--rag-safe-top)); padding-top: var(--rag-safe-top); }
  .rag-input-container { padding: 12px; padding-bottom: calc(12px + var(--rag-safe-bottom)); }
  .rag-chat-messages { padding-left: 14px; padding-right: 14px; padding-bottom: 6px; }
}

/* ---------- ACCESSIBILITY ---------- */
.rag-sr-only { position:absolute !important; width:1px; height:1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; }
:focus { outline-offset: 2px; }

/* ---------- SMALL LAYOUT TWEAKS ---------- */
@media (min-width: 1000px) {
  #rag-chat-window { width: var(--rag-width); }
}
