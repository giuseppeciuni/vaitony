{% extends 'users/base_users.html' %}
{% load static %}

{% block user_content %}
    {% if form.errors %}
        <div class="vaitony-alert vaitony-alert-error" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; min-width: 300px; animation: slideInDown 0.5s ease-out;">
            <i class="bi bi-exclamation-triangle-fill" style="margin-right: 0.75rem; font-size: 1.1rem;"></i>
            <div>
                <strong>Errore imprevisto</strong>
                {% for key, value in form.errors.items %}
                    <br/><small>{{ key }}: {{ value.0 }}</small>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <div class="vaitony-auth-container">
        <div class="vaitony-auth-box" style="max-width: 500px;">

            <!-- Success Celebration Card -->
            <div style="background: var(--vaitony-white); border-radius: var(--vaitony-radius-2xl); box-shadow: var(--vaitony-shadow-xl); overflow: hidden; position: relative;">

                <!-- Animated Success Header -->
                <div style="background: linear-gradient(135deg, var(--vaitony-success) 0%, var(--vaitony-cyber-cyan) 50%, var(--vaitony-primary) 100%); padding: 3rem 2rem; text-align: center; position: relative; overflow: hidden;">

                    <!-- Floating Success Particles -->
                    <div id="successParticles" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;"></div>

                    <!-- Background Pattern -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; background-image: url('data:image/svg+xml,<svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"none\" fill-rule=\"evenodd\"><g fill=\"%23ffffff\" fill-opacity=\"0.3\"><path d=\"M20 20l10-10v20l-10-10zm0 0l-10 10h20l-10-10z\"/></g></svg>'); background-size: 20px 20px;"></div>

                    <!-- Main Success Icon -->
                    <div style="position: relative; z-index: 10;">
                        <div style="position: relative; display: inline-block; margin-bottom: 1.5rem;">
                            <!-- Main Icon Container -->
                            <div class="vaitony-logo" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 3px solid rgba(255, 255, 255, 0.3); width: 100px; height: 100px; margin: 0 auto; position: relative;">
                                <i class="bi bi-shield-check-fill" style="font-size: 3rem; color: white;"></i>

                                <!-- Success Pulse Rings -->
                                <div style="position: absolute; top: -8px; left: -8px; right: -8px; bottom: -8px; border: 2px solid rgba(255, 255, 255, 0.4); border-radius: 50%; animation: successPulse 2s ease-in-out infinite;"></div>
                                <div style="position: absolute; top: -16px; left: -16px; right: -16px; bottom: -16px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%; animation: successPulse 2s ease-in-out infinite 0.5s;"></div>
                            </div>

                            <!-- Floating Check Badge -->
                            <div style="position: absolute; top: -5px; right: -5px; width: 35px; height: 35px; background: var(--vaitony-white); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid var(--vaitony-success); animation: bounceIn 1s ease-out 1s both;">
                                <i class="bi bi-check-lg" style="color: var(--vaitony-success); font-size: 1.2rem; font-weight: bold;"></i>
                            </div>
                        </div>

                        <h1 style="color: white; font-size: 2.4rem; font-weight: 800; margin-bottom: 0.75rem; letter-spacing: -0.02em;">
                            Password Aggiornata!
                        </h1>

                        <div style="display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.15); padding: 0.75rem 1.5rem; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i class="bi bi-lock-fill" style="color: white; margin-right: 0.75rem; font-size: 1rem;"></i>
                            <span style="color: white; font-size: 1rem; font-weight: 600;">Sicurezza Potenziata</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div style="padding: 3rem 2rem;">

                    <!-- Success Message -->
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <h2 style="color: var(--vaitony-dark); font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.3;">
                            Cambio Password Completato
                        </h2>
                        <p style="color: var(--vaitony-gray-600); font-size: 1.1rem; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                            La tua password √® stata modificata con successo e il tuo account VAITony √® ora pi√π sicuro che mai.
                        </p>
                    </div>

                    <!-- Security Confirmation Grid -->
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(6, 182, 212, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: var(--vaitony-radius-xl); padding: 2rem; margin-bottom: 2.5rem;">
                        <h3 style="color: var(--vaitony-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
                            <i class="bi bi-shield-fill-check" style="color: var(--vaitony-success); margin-right: 0.75rem; font-size: 1.4rem;"></i>
                            Sicurezza Account Verificata
                        </h3>

                        <div style="display: grid; gap: 1.25rem;">
                            <!-- Security Check 1 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-success);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-key-fill" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Nuova Password Attivata
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        La password √® stata crittografata e salvata nel sistema
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>

                            <!-- Security Check 2 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-primary);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-person-lock" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Sessioni Aggiornate
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        Tutte le sessioni attive sono state sincronizzate
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>

                            <!-- Security Check 3 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-cyber-cyan);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-cyber-cyan); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-shield-plus" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Protezione Rafforzata
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        Il livello di sicurezza del tuo account √® aumentato
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Continue Button -->
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <a
                            href="{% url 'login' %}"
                            id="continueButton"
                            class="vaitony-btn vaitony-btn-gradient"
                            style="display: inline-flex; align-items: center; padding: 1.25rem 2.5rem; font-size: 1.1rem; font-weight: 700; text-decoration: none; position: relative; overflow: hidden; min-width: 280px; justify-content: center;"
                        >
                            <i class="bi bi-box-arrow-in-right" style="margin-right: 1rem; font-size: 1.3rem;"></i>
                            <span>Continua su VAITony</span>

                            <!-- Button Animation Effect -->
                            <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s;"></div>
                        </a>
                    </div>

                </div>
            </div>

            <!-- Success Stats -->
            <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                <div style="text-align: center; padding: 1.25rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(16, 185, 129, 0.2);">
                    <i class="bi bi-shield-fill-check" style="font-size: 1.8rem; color: var(--vaitony-success); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-success); margin-bottom: 0.25rem;">‚úì</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Protetto</div>
                </div>

                <div style="text-align: center; padding: 1.25rem; background: rgba(37, 99, 235, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(37, 99, 235, 0.2);">
                    <i class="bi bi-lightning-charge" style="font-size: 1.8rem; color: var(--vaitony-primary); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-primary); margin-bottom: 0.25rem;">2s</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Veloce</div>
                </div>

                <div style="text-align: center; padding: 1.25rem; background: rgba(6, 182, 212, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(6, 182, 212, 0.2);">
                    <i class="bi bi-robot" style="font-size: 1.8rem; color: var(--vaitony-cyber-cyan); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-cyber-cyan); margin-bottom: 0.25rem;">AI</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Ready</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize success animations
            initializeSuccessAnimations();

            // Add button hover effects
            addButtonEffects();

            // Create celebration particles
            setTimeout(createCelebrationParticles, 500);

            // Animate security cards
            animateSecurityCards();
        });

        function initializeSuccessAnimations() {
            // Main success icon bounce
            const successIcon = document.querySelector('.bi-shield-check-fill');
            if (successIcon) {
                successIcon.style.animation = 'bounceIn 1s ease-out 0.5s both';
            }

            // Header slide in
            const header = document.querySelector('[style*="background: linear-gradient(135deg, var(--vaitony-success)"]');
            if (header) {
                header.style.animation = 'slideInDown 0.8s ease-out';
            }
        }

        function addButtonEffects() {
            const continueButton = document.getElementById('continueButton');
            if (continueButton) {
                continueButton.addEventListener('mouseenter', function() {
                    const shimmer = this.querySelector('[style*="position: absolute"]');
                    if (shimmer) {
                        shimmer.style.left = '0%';
                    }
                    this.style.transform = 'translateY(-3px)';
                    this.style.boxShadow = 'var(--vaitony-shadow-xl)';
                });

                continueButton.addEventListener('mouseleave', function() {
                    const shimmer = this.querySelector('[style*="position: absolute"]');
                    if (shimmer) {
                        shimmer.style.left = '-100%';
                    }
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'var(--vaitony-shadow-lg)';
                });
            }
        }

        function createCelebrationParticles() {
            const particlesContainer = document.getElementById('successParticles');
            const emojis = ['üéâ', '‚ú®', 'üîí', 'üõ°Ô∏è', '‚≠ê', 'üí´'];

            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                const emoji = emojis[Math.floor(Math.random() * emojis.length)];

                particle.innerHTML = emoji;
                particle.style.cssText = `
                    position: absolute;
                    font-size: 1.5rem;
                    opacity: 0;
                    pointer-events: none;
                    animation: floatUp 3s ease-out infinite;
                    animation-delay: ${i * 0.3}s;
                    left: ${Math.random() * 100}%;
                    top: 100%;
                `;

                particlesContainer.appendChild(particle);
            }

            setTimeout(() => {
                particlesContainer.innerHTML = '';
            }, 6000);
        }

        function animateSecurityCards() {
            const cards = document.querySelectorAll('[style*="border-left: 4px solid"]');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateX(-30px)';

                setTimeout(() => {
                    card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    card.style.opacity = '1';
                    card.style.transform = 'translateX(0)';
                }, (index + 1) * 200);
            });
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes successPulse {
                0%, 100% {
                    transform: scale(1);
                    opacity: 0.7;
                }
                50% {
                    transform: scale(1.05);
                    opacity: 0.3;
                }
            }

            @keyframes bounceIn {
                0% {
                    transform: scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            @keyframes slideInDown {
                from {
                    transform: translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(0);
                }
                25% {
                    opacity: 1;
                    transform: translateY(-20px) scale(1);
                }
                75% {
                    opacity: 0.8;
                    transform: translateY(-50px) scale(1.1);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-80px) scale(0);
                }
            }

            @keyframes slideInDown {
                from { transform: translateY(-100%); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
{% endblock %}