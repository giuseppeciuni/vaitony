{% extends 'users/base_users.html' %}
{% load static %}

{% block user_content %}
    {% if form.errors %}
        <div class="vaitony-alert vaitony-alert-error" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; min-width: 300px;">
            <i class="bi bi-exclamation-triangle-fill" style="margin-right: 0.75rem; font-size: 1.1rem;"></i>
            <div>
                <strong>Errore imprevisto</strong>
                {% for key, value in form.errors.items %}
                    <br/><small>{{ key }}: {{ value.0 }}</small>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <div class="vaitony-auth-container">
        <div class="vaitony-auth-box" style="max-width: 520px;">

            <!-- Success Animation Container -->
            <div id="successContainer" style="background: var(--vaitony-white); border-radius: var(--vaitony-radius-2xl); box-shadow: var(--vaitony-shadow-xl); overflow: hidden; position: relative;">

                <!-- Animated Success Header -->
                <div style="background: linear-gradient(135deg, var(--vaitony-success) 0%, var(--vaitony-cyber-cyan) 50%, var(--vaitony-electric-purple) 100%); padding: 3rem 2rem; text-align: center; position: relative; overflow: hidden;">

                    <!-- Floating Success Particles -->
                    <div id="successParticles" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;"></div>

                    <!-- Success Badge -->
                    <div style="position: relative; z-index: 10;">
                        <div style="position: relative; display: inline-block; margin-bottom: 1.5rem;">
                            <!-- Main Success Icon -->
                            <div class="vaitony-logo" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 3px solid rgba(255, 255, 255, 0.3); width: 100px; height: 100px; margin: 0 auto; position: relative;">
                                <i class="bi bi-check-circle-fill" style="font-size: 3rem; color: white;"></i>

                                <!-- Pulse Animation Ring -->
                                <div style="position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; border: 2px solid rgba(255, 255, 255, 0.4); border-radius: 50%; animation: successPulse 2s ease-in-out infinite;"></div>
                                <div style="position: absolute; top: -20px; left: -20px; right: -20px; bottom: -20px; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%; animation: successPulse 2s ease-in-out infinite 0.5s;"></div>
                            </div>
                        </div>

                        <h1 style="color: white; font-size: 2.5rem; font-weight: 800; margin-bottom: 0.75rem; letter-spacing: -0.02em;">
                            Password Reimpostata!
                        </h1>

                        <div style="display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.15); padding: 0.75rem 1.5rem; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i class="bi bi-shield-check" style="color: white; margin-right: 0.75rem; font-size: 1.1rem;"></i>
                            <span style="color: white; font-size: 1rem; font-weight: 600;">Account Protetto e Sicuro</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div style="padding: 3rem 2rem;">

                    <!-- Success Message -->
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <h2 style="color: var(--vaitony-dark); font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.3;">
                            Operazione Completata con Successo
                        </h2>
                        <p style="color: var(--vaitony-gray-600); font-size: 1.1rem; line-height: 1.6; max-width: 400px; margin: 0 auto;">
                            La tua password è stata aggiornata e il tuo account VAITony è ora protetto con le nuove credenziali.
                        </p>
                    </div>

                    <!-- Security Status Grid -->
                    <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(6, 182, 212, 0.05) 100%); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: var(--vaitony-radius-xl); padding: 2rem; margin-bottom: 2.5rem;">
                        <h3 style="color: var(--vaitony-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
                            <i class="bi bi-shield-fill-check" style="color: var(--vaitony-success); margin-right: 0.75rem; font-size: 1.4rem;"></i>
                            Il Tuo Account è Protetto
                        </h3>

                        <div style="display: grid; gap: 1.25rem;">
                            <!-- Security Feature 1 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-success);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-lock-fill" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Password Crittografata
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        La nuova password è stata crittografata con algoritmi avanzati
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>

                            <!-- Security Feature 2 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-primary);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-key-fill" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Link di Reset Invalidato
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        Il link utilizzato è stato automaticamente disattivato
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>

                            <!-- Security Feature 3 -->
                            <div style="display: flex; align-items: center; padding: 1rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-cyber-cyan);">
                                <div style="width: 48px; height: 48px; background: var(--vaitony-cyber-cyan); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <i class="bi bi-person-check-fill" style="color: white; font-size: 1.2rem;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem;">
                                        Accesso Autorizzato
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.4;">
                                        Solo tu puoi accedere con le nuove credenziali
                                    </p>
                                </div>
                                <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.5rem;"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Call to Action -->
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <a
                            href="{% url 'login' %}"
                            id="loginButton"
                            class="vaitony-btn vaitony-btn-gradient"
                            style="display: inline-flex; align-items: center; padding: 1.25rem 2rem; font-size: 1.1rem; font-weight: 700; text-decoration: none; position: relative; overflow: hidden; min-width: 280px; justify-content: center;"
                        >
                            <i class="bi bi-rocket-takeoff" style="margin-right: 1rem; font-size: 1.3rem;"></i>
                            <span>Accedi a VAITony</span>

                            <!-- Button Animation Effect -->
                            <div style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s;"></div>
                        </a>
                    </div>

                    <!-- Next Steps Guide -->
                    <div style="background: var(--vaitony-gray-50); border-radius: var(--vaitony-radius-xl); padding: 2rem; margin-bottom: 2rem;">
                        <h3 style="color: var(--vaitony-dark); font-size: 1.2rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
                            <i class="bi bi-list-check" style="color: var(--vaitony-primary); margin-right: 0.75rem;"></i>
                            Prossimi Passi Consigliati
                        </h3>

                        <div style="display: grid; gap: 1rem;">
                            <div style="display: flex; align-items: center; padding: 0.75rem; background: white; border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm);">
                                <div style="width: 32px; height: 32px; background: var(--vaitony-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 0.9rem;">1</span>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--vaitony-dark);">Accedi con le nuove credenziali</div>
                                </div>
                                <i class="bi bi-arrow-right" style="color: var(--vaitony-gray-400); font-size: 0.9rem;"></i>
                            </div>

                            <div style="display: flex; align-items: center; padding: 0.75rem; background: white; border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm);">
                                <div style="width: 32px; height: 32px; background: var(--vaitony-success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 0.9rem;">2</span>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--vaitony-dark);">Verifica le impostazioni profilo</div>
                                </div>
                                <i class="bi bi-arrow-right" style="color: var(--vaitony-gray-400); font-size: 0.9rem;"></i>
                            </div>

                            <div style="display: flex; align-items: center; padding: 0.75rem; background: white; border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm);">
                                <div style="width: 32px; height: 32px; background: var(--vaitony-electric-purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 0.9rem;">3</span>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--vaitony-dark);">Esplora le funzionalità AI</div>
                                </div>
                                <i class="bi bi-rocket-takeoff" style="color: var(--vaitony-electric-purple); font-size: 0.9rem;"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Security Notice -->
                    <div style="background: rgba(37, 99, 235, 0.05); border: 1px solid rgba(37, 99, 235, 0.2); border-radius: var(--vaitony-radius-lg); padding: 1.5rem; text-align: center;">
                        <i class="bi bi-info-circle-fill" style="color: var(--vaitony-primary); font-size: 1.3rem; margin-bottom: 0.75rem;"></i>
                        <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                            Nota di Sicurezza
                        </h4>
                        <p style="color: var(--vaitony-gray-600); font-size: 0.85rem; margin: 0; line-height: 1.5;">
                            La tua nuova password è stata crittografata e salvata in modo sicuro. Il link di reset utilizzato è stato automaticamente invalidato per proteggerti.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Success Statistics -->
            <div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                <div style="text-align: center; padding: 1.25rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(16, 185, 129, 0.2);">
                    <i class="bi bi-shield-check" style="font-size: 1.8rem; color: var(--vaitony-success); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-success); margin-bottom: 0.25rem;">100%</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Sicuro</div>
                </div>

                <div style="text-align: center; padding: 1.25rem; background: rgba(37, 99, 235, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(37, 99, 235, 0.2);">
                    <i class="bi bi-lightning-charge" style="font-size: 1.8rem; color: var(--vaitony-primary); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-primary); margin-bottom: 0.25rem;">2s</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Reset Veloce</div>
                </div>

                <div style="text-align: center; padding: 1.25rem; background: rgba(139, 92, 246, 0.1); border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(139, 92, 246, 0.2);">
                    <i class="bi bi-robot" style="font-size: 1.8rem; color: var(--vaitony-electric-purple); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--vaitony-electric-purple); margin-bottom: 0.25rem;">AI</div>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Pronto</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize success animations
            initializeSuccessAnimations();

            // Add button hover effects
            addButtonEffects();

            // Create celebration particles
            setTimeout(createCelebrationParticles, 500);

            // Add security features animation
            animateSecurityFeatures();
        });

        function initializeSuccessAnimations() {
            // Animate main success icon
            const successIcon = document.querySelector('.bi-check-circle-fill');
            if (successIcon) {
                successIcon.style.animation = 'bounceIn 1s ease-out 0.5s both';
            }

            // Animate header with scale effect
            const header = document.querySelector('[style*="background: linear-gradient(135deg, var(--vaitony-success)"]');
            if (header) {
                header.style.animation = 'slideInDown 0.8s ease-out';
            }
        }

        function addButtonEffects() {
            const loginButton = document.getElementById('loginButton');
            if (loginButton) {
                loginButton.addEventListener('mouseenter', function() {
                    const shimmer = this.querySelector('[style*="position: absolute"]');
                    if (shimmer) {
                        shimmer.style.left = '0%';
                    }
                });

                loginButton.addEventListener('mouseleave', function() {
                    const shimmer = this.querySelector('[style*="position: absolute"]');
                    if (shimmer) {
                        shimmer.style.left = '-100%';
                    }
                });
            }
        }

        function createCelebrationParticles() {
            const particlesContainer = document.getElementById('successParticles');
            const emojis = ['🎉', '✨', '🚀', '🎊', '⭐', '💫', '🔥'];

            // Create floating particles
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                const emoji = emojis[Math.floor(Math.random() * emojis.length)];

                particle.innerHTML = emoji;
                particle.style.cssText = `
                    position: absolute;
                    font-size: 1.5rem;
                    opacity: 0;
                    pointer-events: none;
                    animation: floatUp 4s ease-out infinite;
                    animation-delay: ${i * 0.3}s;
                    left: ${Math.random() * 100}%;
                    top: 100%;
                `;

                particlesContainer.appendChild(particle);
            }

            // Remove particles after animation
            setTimeout(() => {
                particlesContainer.innerHTML = '';
            }, 8000);
        }

        function animateSecurityFeatures() {
            const features = document.querySelectorAll('[style*="border-left: 4px solid"]');
            features.forEach((feature, index) => {
                feature.style.opacity = '0';
                feature.style.transform = 'translateX(-30px)';

                setTimeout(() => {
                    feature.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    feature.style.opacity = '1';
                    feature.style.transform = 'translateX(0)';
                }, (index + 1) * 300);
            });
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes successPulse {
                0%, 100% {
                    transform: scale(1);
                    opacity: 0.7;
                }
                50% {
                    transform: scale(1.1);
                    opacity: 0.3;
                }
            }

            @keyframes bounceIn {
                0% {
                    transform: scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.05);
                }
                70% {
                    transform: scale(0.9);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            @keyframes slideInDown {
                from {
                    transform: translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes floatUp {
                0% {
                    opacity: 1;
                    transform: translateY(0) scale(0);
                }
                25% {
                    opacity: 1;
                    transform: translateY(-20px) scale(1);
                }
                75% {
                    opacity: 0.8;
                    transform: translateY(-60px) scale(1.2);
                }
                100% {
                    opacity: 0;
                    transform: translateY(-100px) scale(0);
                }
            }

            .vaitony-btn:hover {
                transform: translateY(-2px);
                box-shadow: var(--vaitony-shadow-xl);
            }
        `;
        document.head.appendChild(style);
    </script>
{% endblock %}