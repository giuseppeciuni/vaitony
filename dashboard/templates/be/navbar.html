{% load static %}
<nav class="app-header navbar navbar-expand bg-body">
    <div class="container-fluid">
        <!-- Start Navbar Links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
                    <i class="bi bi-list"></i>
                </a>
            </li>

            <!-- Dynamic Breadcrumb Navigation -->
            <li class="nav-item d-none d-md-block">
                <a href="{% url 'dashboard' %}" class="nav-link py-1">
                    <i class="bi bi-house-fill me-1"></i>Dashboard
                </a>
            </li>

            {% if 'documents_uploaded' in request.resolver_match.url_name or 'upload_document' in request.resolver_match.url_name or 'upload_folder' in request.resolver_match.url_name %}
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1 text-muted">
                        <i class="bi bi-chevron-right fs-6"></i>
                    </span>
                </li>
                <li class="nav-item d-none d-md-block">
                    <a href="{% url 'documents_uploaded' %}" class="nav-link py-1">
                        <i class="bi bi-files me-1"></i>Documenti
                    </a>
                </li>

                {% if 'upload_document' in request.resolver_match.url_name %}
                    <li class="nav-item d-none d-md-block">
                        <span class="nav-link py-1 text-muted">
                            <i class="bi bi-chevron-right fs-6"></i>
                        </span>
                    </li>
                    <li class="nav-item d-none d-md-block">
                        <a href="{% url 'upload_document' %}" class="nav-link py-1">
                            <i class="bi bi-file-earmark-plus me-1"></i>Carica documento
                        </a>
                    </li>
                {% endif %}

                {% if 'upload_folder' in request.resolver_match.url_name %}
                    <li class="nav-item d-none d-md-block">
                        <span class="nav-link py-1 text-muted">
                            <i class="bi bi-chevron-right fs-6"></i>
                        </span>
                    </li>
                    <li class="nav-item d-none d-md-block">
                        <a href="{% url 'upload_folder' %}" class="nav-link py-1">
                            <i class="bi bi-folder-plus me-1"></i>Carica cartella
                        </a>
                    </li>
                {% endif %}
            {% endif %}

            {% if 'projects_list' in request.resolver_match.url_name or 'new_project' in request.resolver_match.url_name %}
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1 text-muted">
                        <i class="bi bi-chevron-right fs-6"></i>
                    </span>
                </li>
                <li class="nav-item d-none d-md-block">
                    <a href="{% url 'projects_list' %}" class="nav-link py-1">
                        <i class="bi bi-kanban me-1"></i>Progetti
                    </a>
                </li>

                {% if 'new_project' in request.resolver_match.url_name %}
                    <li class="nav-item d-none d-md-block">
                        <span class="nav-link py-1 text-muted">
                            <i class="bi bi-chevron-right fs-6"></i>
                        </span>
                    </li>
                    <li class="nav-item d-none d-md-block">
                        <a href="{% url 'new_project' %}" class="nav-link py-1">
                            <i class="bi bi-plus-square me-1"></i>Nuovo progetto
                        </a>
                    </li>
                {% endif %}
            {% endif %}

            {% if 'project' in request.resolver_match.url_name and 'projects_list' not in request.resolver_match.url_name and 'new_project' not in request.resolver_match.url_name %}
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1 text-muted">
                        <i class="bi bi-chevron-right fs-6"></i>
                    </span>
                </li>
                <li class="nav-item d-none d-md-block">
                    <a href="{% url 'projects_list' %}" class="nav-link py-1">
                        <i class="bi bi-kanban me-1"></i>Progetti
                    </a>
                </li>
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1 text-muted">
                        <i class="bi bi-chevron-right fs-6"></i>
                    </span>
                </li>
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1">
                        <i class="bi bi-folder2-open me-1"></i>{{ project.name|truncatechars:25 }}
                    </span>
                </li>
            {% endif %}

            {% if 'ia_engine' in request.resolver_match.url_name or 'rag_params' in request.resolver_match.url_name %}
                <li class="nav-item d-none d-md-block">
                    <span class="nav-link py-1 text-muted">
                        <i class="bi bi-chevron-right fs-6"></i>
                    </span>
                </li>
                <li class="nav-item d-none d-md-block">
                    <a href="#" class="nav-link py-1">
                        <i class="bi bi-gear me-1"></i>Impostazioni
                    </a>
                </li>

                {% if 'ia_engine' in request.resolver_match.url_name %}
                    <li class="nav-item d-none d-md-block">
                        <span class="nav-link py-1 text-muted">
                            <i class="bi bi-chevron-right fs-6"></i>
                        </span>
                    </li>
                    <li class="nav-item d-none d-md-block">
                        <a href="{% url 'ia_engine' %}" class="nav-link py-1">
                            <i class="bi bi-cpu me-1"></i>Motore IA
                        </a>
                    </li>
                {% endif %}

                {% if 'rag_params' in request.resolver_match.url_name %}
                    <li class="nav-item d-none d-md-block">
                        <span class="nav-link py-1 text-muted">
                            <i class="bi bi-chevron-right fs-6"></i>
                        </span>
                    </li>
                    <li class="nav-item d-none d-md-block">
                        <a href="{% url 'rag_params' %}" class="nav-link py-1">
                            <i class="bi bi-sliders me-1"></i>Parametri RAG
                        </a>
                    </li>
                {% endif %}
            {% endif %}
        </ul>

        <!-- End Navbar Links -->
        <ul class="navbar-nav ms-auto">
            <!-- Fullscreen Toggle -->
            <li class="nav-item">
                <a class="nav-link py-1" href="#" data-lte-toggle="fullscreen">
                    <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
                    <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none;"></i>
                </a>
            </li>

            <!-- User Menu Dropdown -->
            <li class="nav-item dropdown user-menu">
                <a href="#" class="nav-link dropdown-toggle py-1" data-bs-toggle="dropdown">
                    {% if user.profile.picture %}
                        <img src="{{ user.profile.picture.url }}" class="user-image rounded-circle shadow me-1" style="width: 24px; height: 24px;" alt="User Image">
                    {% else %}
                        <img src="{% static 'dist/assets/img/default-150x150.png' %}" class="user-image rounded-circle shadow me-1" style="width: 24px; height: 24px;" alt="User Image">
                    {% endif %}
                    <span class="d-none d-md-inline">{{ user.username }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                    <!-- User Image -->
                    <li class="user-header text-bg-primary">
                        {% if user.profile.picture %}
                            <img src="{{ user.profile.picture.url }}" class="rounded-circle shadow" alt="User Image">
                        {% else %}
                            <img src="{% static 'dist/assets/img/default-150x150.png' %}" class="rounded-circle shadow" alt="User Image">
                        {% endif %}
                        <p>
                            {% if user.profile.first_name and user.profile.last_name %}
                                {{ user.profile.first_name }} {{ user.profile.last_name }}
                            {% elif user.profile.company_name %}
                                {{ user.profile.company_name }}
                            {% else %}
                                {{ user.username }}
                            {% endif %}
                            <small>
                                {% if user.profile.profile_type %}
                                {{ user.profile.profile_type }}
                                {% endif %}
                            </small>
                        </p>
                    </li>

                    <!-- Menu Body -->
                    <li class="user-body">
                        <div class="row">
                            <div class="col-12 text-center">
                                <a href="#" class="text-muted">
                                    <i class="bi bi-envelope me-1"></i> {{ user.email }}
                                </a>
                            </div>
                        </div>
                        {% if user.profile.city or user.profile.country %}
                        <div class="row mt-2">
                            <div class="col-12 text-center">
                                <span class="text-muted small">
                                    <i class="bi bi-geo-alt me-1"></i>
                                    {% if user.profile.city %}{{ user.profile.city }}{% endif %}
                                    {% if user.profile.city and user.profile.country %}, {% endif %}
                                    {% if user.profile.country %}{{ user.profile.country }}{% endif %}
                                </span>
                            </div>
                        </div>
                        {% endif %}
                    </li>

                    <!-- Menu Footer -->
                    <li class="user-footer d-flex justify-content-between p-2">
                        <a href="{% url 'user_profile' %}" class="btn btn-sm btn-outline-secondary">Profilo</a>
                        <form method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger">Esci</button>
                        </form>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</nav>