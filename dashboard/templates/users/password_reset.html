{% extends 'users/base_users.html' %}
{% load static %}

{% block user_content %}
    {% if form.errors %}
        <div class="vaitony-alert vaitony-alert-error" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; min-width: 300px;">
            <i class="bi bi-exclamation-triangle-fill" style="margin-right: 0.75rem; font-size: 1.1rem;"></i>
            <div>
                <strong>Errore di validazione</strong>
                {% for key, value in form.errors.items %}
                    <br/><small>{{ key }}: {{ value.0 }}</small>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <div class="vaitony-auth-container">
        <div class="vaitony-auth-box" style="max-width: 480px;">

            <!-- Header Card with Floating Design -->
            <div style="background: var(--vaitony-white); border-radius: var(--vaitony-radius-2xl); box-shadow: var(--vaitony-shadow-xl); overflow: hidden; margin-bottom: 2rem;">

                <!-- Animated Header -->
                <div style="background: linear-gradient(135deg, var(--vaitony-primary) 0%, var(--vaitony-electric-purple) 50%, var(--vaitony-cyber-cyan) 100%); padding: 2.5rem 2rem; text-align: center; position: relative; overflow: hidden;">

                    <!-- Background Pattern -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; background-image: url('data:image/svg+xml,<svg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"><g fill=\"none\" fill-rule=\"evenodd\"><g fill=\"%23ffffff\" fill-opacity=\"0.3\"><circle cx=\"30\" cy=\"30\" r=\"4\"/></g></svg>'); background-size: 30px 30px;"></div>

                    <!-- Floating Logo -->
                    <div style="position: relative; z-index: 2;">
                        <div class="vaitony-logo vaitony-ai-pulse" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 2px solid rgba(255, 255, 255, 0.2); width: 80px; height: 80px; margin: 0 auto 1.5rem;">
                            <i class="bi bi-key-fill" style="font-size: 2.5rem; color: white;"></i>
                        </div>

                        <h1 style="color: white; font-size: 2.2rem; font-weight: 800; margin-bottom: 0.5rem; letter-spacing: -0.02em;">
                            VAI<span style="background: linear-gradient(45deg, #ffffff, #e0e7ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Tony</span>
                        </h1>

                        <div style="display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 50px; backdrop-filter: blur(10px);">
                            <i class="bi bi-shield-lock" style="color: white; margin-right: 0.5rem; font-size: 0.9rem;"></i>
                            <span style="color: white; font-size: 0.9rem; font-weight: 500;">Recupero Sicuro</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div style="padding: 2.5rem 2rem;">

                    <!-- Title Section -->
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--vaitony-dark); font-size: 1.75rem; font-weight: 700; margin-bottom: 0.75rem; line-height: 1.2;">
                            Password Dimenticata?
                        </h2>
                        <p style="color: var(--vaitony-gray-600); font-size: 1rem; line-height: 1.6; max-width: 320px; margin: 0 auto;">
                            Nessun problema! Inserisci la tua email e ti invieremo un link sicuro per ripristinare l'accesso.
                        </p>
                    </div>

                    <!-- Security Badge -->
                    <div style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); border: 1px solid rgba(37, 99, 235, 0.2); padding: 1.25rem; border-radius: var(--vaitony-radius-xl); margin-bottom: 2rem;">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="width: 40px; height: 40px; background: var(--vaitony-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                <i class="bi bi-shield-check" style="color: white; font-size: 1.1rem;"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    Processo Sicuro Garantito
                                </h4>
                                <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; line-height: 1.5; margin: 0;">
                                    Il link di reset è crittografato, valido per 24 ore e utilizzabile una sola volta per garantire la massima sicurezza del tuo account.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Reset Form -->
                    <form action="{% url 'password_reset' %}" method="post" style="margin-bottom: 2rem;">
                        {% csrf_token %}

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; color: var(--vaitony-dark); font-weight: 600; font-size: 0.9rem; margin-bottom: 0.75rem;">
                                <i class="bi bi-envelope-at" style="color: var(--vaitony-primary); margin-right: 0.5rem;"></i>
                                Indirizzo Email
                            </label>

                            <div style="position: relative;">
                                <input
                                    id="resetEmail"
                                    type="email"
                                    name="email"
                                    class="vaitony-input"
                                    placeholder="inserisci@tuaemail.com"
                                    required
                                    autocomplete="email"
                                    style="padding-left: 3rem; font-size: 1rem; height: 56px;"
                                />
                                <div style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--vaitony-gray-400); font-size: 1.1rem;">
                                    <i class="bi bi-envelope"></i>
                                </div>
                            </div>

                            <small style="color: var(--vaitony-gray-500); font-size: 0.8rem; margin-top: 0.5rem; display: block;">
                                <i class="bi bi-info-circle" style="margin-right: 0.25rem;"></i>
                                Usa l'email con cui ti sei registrato su VAITony
                            </small>
                        </div>

                        <!-- Submit Button with Loading Animation -->
                        <button
                            type="submit"
                            id="resetButton"
                            class="vaitony-btn vaitony-btn-gradient"
                            style="width: 100%; padding: 1rem 1.5rem; font-size: 1rem; font-weight: 600; position: relative; overflow: hidden;"
                        >
                            <span id="buttonText">
                                <i class="bi bi-send" style="margin-right: 0.75rem; font-size: 1.1rem;"></i>
                                Invia Link di Recupero
                            </span>
                            <span id="buttonLoading" style="display: none;">
                                <i class="bi bi-arrow-repeat" style="margin-right: 0.75rem; animation: spin 1s linear infinite;"></i>
                                Invio in corso...
                            </span>
                        </button>
                    </form>

                    <!-- Alternative Actions -->
                    <div style="border-top: 1px solid var(--vaitony-gray-200); padding-top: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <a
                                href="{% url 'login' %}"
                                style="display: flex; align-items: center; justify-content: center; padding: 0.875rem; background: var(--vaitony-gray-50); color: var(--vaitony-gray-700); text-decoration: none; border-radius: var(--vaitony-radius-lg); font-size: 0.9rem; font-weight: 500; transition: var(--vaitony-transition);"
                                onmouseover="this.style.background='var(--vaitony-gray-100)'"
                                onmouseout="this.style.background='var(--vaitony-gray-50)'"
                            >
                                <i class="bi bi-arrow-left" style="margin-right: 0.5rem;"></i>
                                Torna al Login
                            </a>

                            <a
                                href="{% url 'register' %}"
                                style="display: flex; align-items: center; justify-content: center; padding: 0.875rem; background: var(--vaitony-white); color: var(--vaitony-primary); border: 2px solid var(--vaitony-primary); text-decoration: none; border-radius: var(--vaitony-radius-lg); font-size: 0.9rem; font-weight: 500; transition: var(--vaitony-transition);"
                                onmouseover="this.style.background='var(--vaitony-primary)'; this.style.color='white'"
                                onmouseout="this.style.background='var(--vaitony-white)'; this.style.color='var(--vaitony-primary)'"
                            >
                                <i class="bi bi-person-plus" style="margin-right: 0.5rem;"></i>
                                Nuovo Account
                            </a>
                        </div>

                        <!-- Help Section -->
                        <div style="text-align: center;">
                            <p style="color: var(--vaitony-gray-600); font-size: 0.85rem; margin-bottom: 0.5rem;">
                                <i class="bi bi-question-circle" style="margin-right: 0.25rem;"></i>
                                Hai bisogno di aiuto?
                            </p>
                            <a
                                href="mailto:support@vaitony.com"
                                style="color: var(--vaitony-primary); text-decoration: none; font-size: 0.9rem; font-weight: 600;"
                            >
                                <i class="bi bi-headset" style="margin-right: 0.25rem;"></i>
                                Contatta il supporto VAITony
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trust Indicators -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem;">
                <div style="text-align: center; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--vaitony-radius-lg);">
                    <i class="bi bi-shield-fill-check" style="font-size: 1.5rem; color: var(--vaitony-success); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">100% Sicuro</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: rgba(37, 99, 235, 0.1); border-radius: var(--vaitony-radius-lg);">
                    <i class="bi bi-clock" style="font-size: 1.5rem; color: var(--vaitony-primary); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">24h Validità</div>
                </div>
                <div style="text-align: center; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: var(--vaitony-radius-lg);">
                    <i class="bi bi-lightning-charge" style="font-size: 1.5rem; color: var(--vaitony-electric-purple); margin-bottom: 0.5rem;"></i>
                    <div style="font-size: 0.75rem; color: var(--vaitony-gray-600); font-weight: 600;">Reset Rapido</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const button = document.getElementById('resetButton');
            const buttonText = document.getElementById('buttonText');
            const buttonLoading = document.getElementById('buttonLoading');
            const emailInput = document.getElementById('resetEmail');

            // Enhanced form submission
            form.addEventListener('submit', function(e) {
                // Show loading state
                buttonText.style.display = 'none';
                buttonLoading.style.display = 'inline-flex';
                button.disabled = true;
                button.style.background = 'var(--vaitony-gray-500)';

                // Prevent multiple submissions
                setTimeout(() => {
                    if (!form.submitted) {
                        form.submitted = true;
                    }
                }, 100);
            });

            // Email validation with visual feedback
            emailInput.addEventListener('input', function() {
                const email = this.value;
                const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

                if (email.length > 0) {
                    if (isValid) {
                        this.style.borderColor = 'var(--vaitony-success)';
                        this.style.boxShadow = '0 0 0 3px rgba(16, 185, 129, 0.1)';
                    } else {
                        this.style.borderColor = 'var(--vaitony-error)';
                        this.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                    }
                } else {
                    this.style.borderColor = 'var(--vaitony-gray-300)';
                    this.style.boxShadow = 'none';
                }
            });

            // Add floating label effect
            emailInput.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
                this.parentElement.style.boxShadow = 'var(--vaitony-shadow-lg)';
            });

            emailInput.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
                this.parentElement.style.boxShadow = 'var(--vaitony-shadow-md)';
            });

            // Add success animation for trust indicators
            const indicators = document.querySelectorAll('[style*="grid-template-columns: repeat(3, 1fr)"] > div');
            indicators.forEach((indicator, index) => {
                setTimeout(() => {
                    indicator.style.animation = 'slideInUp 0.6s ease-out';
                }, index * 200);
            });
        });

        // Add animations CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .vaitony-input:focus {
                transform: translateY(-1px);
                transition: all 0.2s ease;
            }
        `;
        document.head.appendChild(style);
    </script>
{% endblock %}