/* rag-chat-widget.css
   UX ispirata a Telegram / WhatsApp
   Mobile-friendly, safe-area aware, Android keyboard fixes
   --- */

:root{
  --r-color-primary: #1f8ef7;    /* blu Telegram-like */
  --r-color-accent: #e9f5ff;
  --r-color-user: #dcf8c6;       /* verde WhatsApp-like */
  --r-color-bot: #ffffff;
  --r-text: #1f2a37;
  --r-muted: #7b8794;
  --r-border: #e6eefc;
  --r-radius: 18px;
  --r-radius-small: 8px;
  --r-shadow: 0 6px 20px rgba(20,30,50,0.12);
  --r-width: 380px;
  --r-height: 640px;
  --r-header-h: 64px;
  --r-input-h: 68px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

/* RESET e base */
#rag-chat-widget, #rag-chat-widget * { box-sizing: border-box; font-family: -apple-system, system-ui, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-tap-highlight-color: transparent; }
.rag-sr { position: absolute !important; width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

/* CONTENITORE GLOBALE (fisso in pagina) */
#rag-chat-widget {
  position: fixed;
  right: 20px;
  bottom: 20px;
  z-index: 999999;
  width: var(--r-width);
  max-width: calc(100% - 40px);
  font-size: 14px;
  direction: ltr;
  -webkit-user-select: none; user-select: none;
}

/* BUBBLE (l'icona flottante) */
#rag-chat-bubble {
  width: 64px; height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--r-color-primary), #0b63c6);
  display:flex; align-items:center; justify-content:center;
  box-shadow: var(--r-shadow);
  cursor:pointer; border: 3px solid #fff;
  transition: transform .15s ease, box-shadow .15s ease;
}
#rag-chat-bubble:active{ transform: scale(.96); }
#rag-chat-bubble svg{ width:26px; height:26px; fill:#fff; pointer-events:none; }

/* FINESTRA CHAT (desktop) */
#rag-chat-window {
  position: absolute;
  right: 0;
  bottom: calc(64px + 12px);
  width: var(--r-width);
  height: var(--r-height);
  max-height: calc(100vh - 120px);
  border-radius: 14px;
  background: linear-gradient(180deg,#f7fbff,#ffffff);
  box-shadow: var(--r-shadow);
  border: 1px solid var(--r-border);
  display: none;
  flex-direction: column;
  overflow: hidden;
  transform-origin: bottom right;
}

/* HEADER */
.rag-chat-header {
  height: var(--r-header-h);
  min-height: var(--r-header-h);
  display:flex; align-items:center; gap:12px;
  padding: 12px 14px;
  background: linear-gradient(90deg,var(--r-color-primary), #0b63c6);
  color: #fff;
  flex-shrink: 0;
}
.rag-bot-avatar{ width:44px; height:44px; border-radius:50%; background: #fff; display:flex;align-items:center;justify-content:center;color:var(--r-color-primary); box-shadow: 0 1px 3px rgba(0,0,0,.06);}
.rag-header-info{ display:flex; flex-direction:column; min-width:0; }
.rag-header-title{ font-weight:700; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.rag-header-sub{ font-size:12px; opacity:.9; color: rgba(255,255,255,.95); }
.rag-close-btn { background: transparent; border: none; color: white; width:44px;height:44px;border-radius:50%; display:flex;align-items:center;justify-content:center; cursor:pointer; }

/* AREA MESSAGGI */
.rag-chat-messages {
  padding: 14px 12px 18px 12px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  background: linear-gradient(180deg,#f6fbff, #f8fbff);
  flex:1;
  scroll-behavior: smooth;
}

/* BOLLE MESSAGGI */
.rag-message { margin:10px 0; max-width:84%; clear:both; display:block; word-wrap:break-word; }

.rag-message.bot {
  float:left;
  background: var(--r-color-bot);
  color: var(--r-text);
  padding: 12px 14px;
  border-radius: var(--r-radius) var(--r-radius) var(--r-radius-small) var(--r-radius);
  box-shadow: 0 1px 4px rgba(20,30,50,0.04);
  border: 1px solid rgba(0,0,0,0.03);
  font-size: 14px; line-height:1.45;
}

.rag-message.user {
  float:right;
  background: var(--r-color-user);
  color: var(--r-text);
  padding: 10px 14px;
  border-radius: var(--r-radius) var(--r-radius) var(--r-radius) var(--r-radius-small);
  box-shadow: 0 1px 4px rgba(20,30,50,0.04);
  font-size: 14px; line-height:1.3;
  border: 1px solid rgba(0,0,0,0.02);
}

/* timestamp */
.rag-message-time { display:block; text-align:right; color:var(--r-muted); font-size:11px; margin-top:6px; opacity:.9; }

/* link and titles inside bot messages */
.rag-message.bot a { color: var(--r-color-primary); text-decoration: none; font-weight:500; word-break:break-word; }
.rag-message.bot h2, .rag-message.bot h3 { margin:6px 0; color:var(--r-color-primary); }

/* typing indicator */
.rag-typing{ display:flex; gap:8px; align-items:center; justify-content:flex-start; padding:10px 12px; border-radius:14px; background: linear-gradient(90deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01)); }
.rag-typing-dot{ width:8px; height:8px; border-radius:50%; background:var(--r-muted); animation: rag-pulse .9s infinite ease-in-out; }
.rag-typing-dot:nth-child(2){ animation-delay:.12s } .rag-typing-dot:nth-child(3){ animation-delay:.24s }
@keyframes rag-pulse { 0% { transform:scale(.7); opacity:.4 } 50% { transform:scale(1.2); opacity:1 } 100% { transform:scale(.7); opacity:.4 } }

/* AREA INPUT */
.rag-input-container {
  padding: 12px;
  background: #fff;
  border-top: 1px solid var(--r-border);
  flex-shrink:0;
}
.rag-input-wrapper { display:flex; gap:10px; align-items:flex-end; }
.rag-chat-input {
  flex:1; min-height:42px; max-height:120px; resize:none;
  padding:10px 14px; border-radius:22px; border:1px solid #e9eefc; outline:none;
  font-size:14px; line-height:1.3; overflow:auto; background:#fbfeff;
}
.rag-chat-input:focus{ box-shadow: 0 4px 18px rgba(31,142,247,0.08); border-color: var(--r-color-primary); }
.rag-send-btn{ width:52px; height:52px; border-radius:50%; border:none; background:var(--r-color-primary); color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow: 0 6px 18px rgba(31,142,247,0.16); }
.rag-send-btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; }

/* BRANDING (piccolo) */
.rag-branding{ font-size:11px; color:var(--r-muted); text-align:center; padding-top:6px; }

/* MOBILE: fullscreen experience */
@media (max-width: 768px) {
  #rag-chat-widget{ left:0; right:0; bottom:0; top:0; width:100vw; height:100vh; padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); }
  #rag-chat-bubble{ position: fixed; right: 18px; bottom: 18px; z-index: 999999; }
  #rag-chat-window{ position: fixed; top:0; left:0; right:0; bottom:0; width:100vw; height:100vh; max-height:100vh; border-radius:0; display:flex; flex-direction:column; }
  .rag-input-container{ padding: calc(10px + var(--safe-bottom)) 12px 12px 12px; background: linear-gradient(180deg,#ffffff,#fbfeff); position: relative; z-index: 1001; }
  .rag-input-wrapper { align-items:flex-end; }
  .rag-chat-messages{ padding-bottom: 8px; }
}

/* ACCESSIBILITA' */
@media (prefers-reduced-motion: reduce) {
  * { transition:none !important; animation:none !important; scroll-behavior: auto !important; }
}

/* Small screens/Tablet tweaks */
@media (min-width: 769px) and (max-width: 1199px) {
  :root { --r-width: 420px; --r-height: 680px; }
}
