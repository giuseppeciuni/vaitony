{% extends 'users/base_users.html' %}
{% load static %}

{% block user_content %}
    {% if form.errors %}
        <div class="vaitony-alert vaitony-alert-error" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; min-width: 300px; animation: slideInDown 0.5s ease-out;">
            <i class="bi bi-exclamation-triangle-fill" style="margin-right: 0.75rem; font-size: 1.1rem;"></i>
            <div>
                <strong>Errore di registrazione</strong>
                {% for key, value in form.errors.items %}
                    <br/><small>{{ key }}: {{ value.0 }}</small>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <div class="vaitony-auth-container">
        <div class="vaitony-auth-box" style="max-width: 550px;">

            <!-- Main Registration Success Card -->
            <div style="background: var(--vaitony-white); border-radius: var(--vaitony-radius-2xl); box-shadow: var(--vaitony-shadow-xl); overflow: hidden; position: relative;">

                <!-- Animated Header with Email Theme -->
                <div style="background: linear-gradient(135deg, var(--vaitony-info) 0%, var(--vaitony-primary) 50%, var(--vaitony-electric-purple) 100%); padding: 3rem 2rem; text-align: center; position: relative; overflow: hidden;">

                    <!-- Background Email Pattern -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1;">
                        <div style="position: absolute; top: 20%; left: 10%; animation: emailFloat 6s ease-in-out infinite;">
                            <i class="bi bi-envelope" style="font-size: 2rem; color: white;"></i>
                        </div>
                        <div style="position: absolute; top: 60%; right: 15%; animation: emailFloat 6s ease-in-out infinite 2s;">
                            <i class="bi bi-envelope-open" style="font-size: 1.5rem; color: white;"></i>
                        </div>
                        <div style="position: absolute; bottom: 30%; left: 20%; animation: emailFloat 6s ease-in-out infinite 4s;">
                            <i class="bi bi-envelope-check" style="font-size: 1.8rem; color: white;"></i>
                        </div>
                    </div>

                    <!-- Main Icon with Pulse -->
                    <div style="position: relative; z-index: 10;">
                        <div style="position: relative; display: inline-block; margin-bottom: 1.5rem;">
                            <div class="vaitony-logo vaitony-ai-pulse" style="background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 3px solid rgba(255, 255, 255, 0.3); width: 90px; height: 90px; margin: 0 auto;">
                                <i class="bi bi-envelope-heart-fill" style="font-size: 2.5rem; color: white;"></i>
                            </div>

                            <!-- Success Checkmark Overlay -->
                            <div style="position: absolute; top: -5px; right: -5px; width: 30px; height: 30px; background: var(--vaitony-success); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white;">
                                <i class="bi bi-check" style="color: white; font-size: 1rem; font-weight: bold;"></i>
                            </div>
                        </div>

                        <h1 style="color: white; font-size: 2.3rem; font-weight: 800; margin-bottom: 0.75rem; letter-spacing: -0.02em;">
                            Registrazione Completata!
                        </h1>

                        <div style="display: inline-flex; align-items: center; background: rgba(255, 255, 255, 0.15); padding: 0.75rem 1.5rem; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <i class="bi bi-clock-history" style="color: white; margin-right: 0.75rem; font-size: 1rem;"></i>
                            <span style="color: white; font-size: 0.95rem; font-weight: 600;">Email di Verifica Inviata</span>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div style="padding: 3rem 2rem;">

                    <!-- User Welcome Section -->
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <div style="display: inline-flex; align-items: center; background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%); padding: 1rem 1.5rem; border-radius: 50px; margin-bottom: 1.5rem; border: 1px solid rgba(37, 99, 235, 0.2);">
                            <div style="width: 40px; height: 40px; background: var(--vaitony-ai-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                                <i class="bi bi-person-circle" style="color: white; font-size: 1.3rem;"></i>
                            </div>
                            <div style="text-align: left;">
                                <div style="font-size: 0.85rem; color: var(--vaitony-gray-600); margin-bottom: 0.25rem;">Benvenuto</div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: var(--vaitony-primary);">{{ user.username }}</div>
                            </div>
                        </div>

                        <h2 style="color: var(--vaitony-dark); font-size: 1.6rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.3;">
                            Il Tuo Account VAITony è Quasi Pronto!
                        </h2>
                        <p style="color: var(--vaitony-gray-600); font-size: 1rem; line-height: 1.6; max-width: 420px; margin: 0 auto;">
                            Abbiamo inviato un link di attivazione sicuro al tuo indirizzo email. Un ultimo passo e potrai iniziare a utilizzare l'AI di VAITony.
                        </p>
                    </div>

                    <!-- Email Details Card -->
                    <div style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.05) 0%, rgba(37, 99, 235, 0.05) 100%); border: 2px solid rgba(6, 182, 212, 0.2); border-radius: var(--vaitony-radius-xl); padding: 2rem; margin-bottom: 2.5rem; position: relative;">
                        <!-- Decorative Email Icon -->
                        <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 30px; height: 30px; background: var(--vaitony-info); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-envelope-at" style="color: white; font-size: 0.9rem;"></i>
                        </div>

                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <h3 style="color: var(--vaitony-dark); font-size: 1.2rem; font-weight: 700; margin-bottom: 0.75rem;">
                                <i class="bi bi-send-check" style="color: var(--vaitony-info); margin-right: 0.5rem;"></i>
                                Email Inviata a:
                            </h3>

                            <!-- Email Display with Copy Function -->
                            <div style="display: inline-flex; align-items: center; background: var(--vaitony-white); padding: 1rem 1.5rem; border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border: 1px solid var(--vaitony-gray-200); margin-bottom: 1rem;">
                                <i class="bi bi-envelope-fill" style="color: var(--vaitony-primary); margin-right: 0.75rem; font-size: 1.1rem;"></i>
                                <span id="userEmail" style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; font-family: var(--vaitony-font-mono);">{{ user.email }}</span>
                                <button
                                    onclick="copyEmail()"
                                    style="background: none; border: none; margin-left: 0.75rem; color: var(--vaitony-gray-500); cursor: pointer; padding: 0.25rem; border-radius: 4px; transition: var(--vaitony-transition);"
                                    onmouseover="this.style.background='var(--vaitony-gray-100)'; this.style.color='var(--vaitony-primary)'"
                                    onmouseout="this.style.background='none'; this.style.color='var(--vaitony-gray-500)'"
                                    title="Copia email"
                                >
                                    <i class="bi bi-copy" style="font-size: 0.9rem;"></i>
                                </button>
                            </div>

                            <p style="color: var(--vaitony-gray-600); font-size: 0.9rem; line-height: 1.5; margin: 0;">
                                <strong>Controlla la tua casella email</strong> e clicca sul link di attivazione per completare la registrazione e iniziare subito con VAITony.
                            </p>
                        </div>
                    </div>

                    <!-- Step-by-Step Instructions -->
                    <div style="background: var(--vaitony-gray-50); border-radius: var(--vaitony-radius-xl); padding: 2rem; margin-bottom: 2.5rem;">
                        <h3 style="color: var(--vaitony-dark); font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
                            <i class="bi bi-list-ol" style="color: var(--vaitony-primary); margin-right: 0.75rem;"></i>
                            Come Attivare il Tuo Account
                        </h3>

                        <div style="display: grid; gap: 1.25rem;">
                            <!-- Step 1 -->
                            <div style="display: flex; align-items: flex-start; padding: 1.25rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-primary);">
                                <div style="width: 40px; height: 40px; background: var(--vaitony-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 1.1rem;">1</span>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                        Apri la Tua Email
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                        Vai alla tua casella email e cerca il messaggio da <strong>VAITony</strong>. Controlla anche la cartella spam se non lo trovi subito.
                                    </p>
                                </div>
                            </div>

                            <!-- Step 2 -->
                            <div style="display: flex; align-items: flex-start; padding: 1.25rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-success);">
                                <div style="width: 40px; height: 40px; background: var(--vaitony-success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 1.1rem;">2</span>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                        Clicca sul Link di Attivazione
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                        Nel messaggio troverai un pulsante blu "Attiva Account". Cliccaci sopra per verificare il tuo indirizzo email.
                                    </p>
                                </div>
                            </div>

                            <!-- Step 3 -->
                            <div style="display: flex; align-items: flex-start; padding: 1.25rem; background: var(--vaitony-white); border-radius: var(--vaitony-radius-lg); box-shadow: var(--vaitony-shadow-sm); border-left: 4px solid var(--vaitony-electric-purple);">
                                <div style="width: 40px; height: 40px; background: var(--vaitony-electric-purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; flex-shrink: 0;">
                                    <span style="color: white; font-weight: 700; font-size: 1.1rem;">3</span>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--vaitony-dark); font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                        Inizia con VAITony
                                    </h4>
                                    <p style="color: var(--vaitony-gray-600); font-size: 0.875rem; margin: 0; line-height: 1.5;">
                                        Una volta attivato, accedi alla piattaforma e scopri tutti gli strumenti AI disponibili per il tuo lavoro.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Troubleshooting Section -->
                    <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(239, 68, 68, 0.05) 100%); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: var(--vaitony-radius-lg); padding: 1.5rem; margin-bottom: 2rem;">
                        <h4 style="color: var(--vaitony-dark); font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center;">
                            <i class="bi bi-question-circle-fill" style="color: var(--vaitony-warning); margin-right: 0.75rem; font-size: 1.2rem;"></i>
                            Non Trovi l'Email?
                        </h4>

                        <div style="display: grid; gap: 0.75rem; font-size: 0.875rem; color: var(--vaitony-gray-700);">
                            <div style="display: flex; align-items: center;">
                                <i class="bi bi-arrow-right" style="color: var(--vaitony-warning); margin-right: 0.5rem; font-size: 0.8rem;"></i>
                                <span>Controlla la cartella <strong>Spam</strong> o <strong>Posta indesiderata</strong></span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <i class="bi bi-arrow-right" style="color: var(--vaitony-warning); margin-right: 0.5rem; font-size: 0.8rem;"></i>
                                <span>Verifica che l'indirizzo email sia corretto</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <i class="bi bi-arrow-right" style="color: var(--vaitony-warning); margin-right: 0.5rem; font-size: 0.8rem;"></i>
                                <span>Attendi qualche minuto - le email possono avere ritardi</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                        <!-- Resend Email Button -->
                        <button
                            id="resendButton"
                            onclick="resendActivationEmail()"
                            class="vaitony-btn"
                            style="background: var(--vaitony-primary); color: white; padding: 1rem; font-size: 1rem; font-weight: 600; position: relative; overflow: hidden;"
                        >
                            <span id="resendText">
                                <i class="bi bi-arrow-clockwise" style="margin-right: 0.75rem;"></i>
                                Reinvia Email di Attivazione
                            </span>
                            <span id="resendLoading" style="display: none;">
                                <i class="bi bi-hourglass-split" style="margin-right: 0.75rem; animation: spin 1s linear infinite;"></i>
                                Invio in corso...
                            </span>
                        </button>

                        <!-- Secondary Actions -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                            <a
                                href="{% url 'login' %}"
                                style="display: flex; align-items: center; justify-content: center; padding: 0.875rem; background: var(--vaitony-gray-100); color: var(--vaitony-gray-700); text-decoration: none; border-radius: var(--vaitony-radius-lg); font-size: 0.9rem; font-weight: 500; transition: var(--vaitony-transition);"
                                onmouseover="this.style.background='var(--vaitony-gray-200)'"
                                onmouseout="this.style.background='var(--vaitony-gray-100)'"
                            >
                                <i class="bi bi-box-arrow-in-right" style="margin-right: 0.5rem;"></i>
                                Ho già attivato
                            </a>

                            <a
                                href="{% url 'register' %}"
                                style="display: flex; align-items: center; justify-content: center; padding: 0.875rem; background: var(--vaitony-white); color: var(--vaitony-primary); border: 2px solid var(--vaitony-primary); text-decoration: none; border-radius: var(--vaitony-radius-lg); font-size: 0.9rem; font-weight: 500; transition: var(--vaitony-transition);"
                                onmouseover="this.style.background='var(--vaitony-primary)'; this.style.color='white'"
                                onmouseout="this.style.background='var(--vaitony-white)'; this.style.color='var(--vaitony-primary)'"
                            >
                                <i class="bi bi-person-plus" style="margin-right: 0.5rem;"></i>
                                Nuovo Account
                            </a>
                        </div>
                    </div>

                    <!-- Footer Links -->
                    <div style="text-align: center; padding-top: 1.5rem; border-top: 1px solid var(--vaitony-gray-200);">
                        <p style="color: var(--vaitony-gray-600); font-size: 0.85rem; margin-bottom: 0.75rem;">
                            Hai bisogno di aiuto con l'attivazione?
                        </p>
                        <a
                            href="mailto:support@vaitony.com"
                            style="display: inline-flex; align-items: center; color: var(--vaitony-primary); text-decoration: none; font-size: 0.9rem; font-weight: 600; padding: 0.5rem 1rem; background: rgba(37, 99, 235, 0.1); border-radius: var(--vaitony-radius-lg); transition: var(--vaitony-transition);"
                            onmouseover="this.style.background='rgba(37, 99, 235, 0.2)'"
                            onmouseout="this.style.background='rgba(37, 99, 235, 0.1)'"
                        >
                            <i class="bi bi-headset" style="margin-right: 0.5rem;"></i>
                            Contatta il Supporto VAITony
                        </a>
                    </div>
                </div>
            </div>

            <!-- Email Status Indicator -->
            <div style="margin-top: 2rem; text-align: center;">
                <div style="display: inline-flex; align-items: center; background: rgba(16, 185, 129, 0.1); padding: 1rem 1.5rem; border-radius: var(--vaitony-radius-lg); border: 1px solid rgba(16, 185, 129, 0.3);">
                    <div id="emailStatusIcon" style="margin-right: 0.75rem;">
                        <i class="bi bi-check-circle-fill" style="color: var(--vaitony-success); font-size: 1.2rem;"></i>
                    </div>
                    <div style="text-align: left;">
                        <div style="font-size: 0.85rem; color: var(--vaitony-gray-600);">Stato Email</div>
                        <div id="emailStatus" style="font-size: 0.9rem; font-weight: 600; color: var(--vaitony-success);">Inviata con successo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize page animations
            initializeAnimations();

            // Start email status checking
            startEmailStatusCheck();

            // Add interactive effects
            addInteractiveEffects();
        });

        function initializeAnimations() {
            // Animate steps with stagger effect
            const steps = document.querySelectorAll('[style*="border-left: 4px solid"]');
            steps.forEach((step, index) => {
                step.style.opacity = '0';
                step.style.transform = 'translateX(-20px)';

                setTimeout(() => {
                    step.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    step.style.opacity = '1';
                    step.style.transform = 'translateX(0)';
                }, (index + 1) * 200);
            });
        }

        function copyEmail() {
            const email = document.getElementById('userEmail').textContent;
            navigator.clipboard.writeText(email).then(() => {
                showNotification('Email copiata negli appunti!', 'success');
            });
        }

        function resendActivationEmail() {
            const button = document.getElementById('resendButton');
            const textSpan = document.getElementById('resendText');
            const loadingSpan = document.getElementById('resendLoading');

            // Show loading state
            textSpan.style.display = 'none';
            loadingSpan.style.display = 'inline-flex';
            button.disabled = true;
            button.style.background = 'var(--vaitony-gray-500)';

            // Simulate email resend (replace with actual API call)
            setTimeout(() => {
                textSpan.innerHTML = '<i class="bi bi-check-circle" style="margin-right: 0.75rem;"></i>Email Reinviata!';
                textSpan.style.display = 'inline-flex';
                loadingSpan.style.display = 'none';
                button.style.background = 'var(--vaitony-success)';

                showNotification('Email di attivazione reinviata con successo!', 'success');

                // Reset button after 3 seconds
                setTimeout(() => {
                    textSpan.innerHTML = '<i class="bi bi-arrow-clockwise" style="margin-right: 0.75rem;"></i>Reinvia Email di Attivazione';
                    button.disabled = false;
                    button.style.background = 'var(--vaitony-primary)';
                }, 3000);
            }, 2000);
        }

        function startEmailStatusCheck() {
            let checkCount = 0;
            const maxChecks = 5;

            const interval = setInterval(() => {
                checkCount++;

                if (checkCount >= maxChecks) {
                    clearInterval(interval);
                    return;
                }

                // Simulate email delivery status check
                updateEmailStatus();
            }, 10000); // Check every 10 seconds
        }

        function updateEmailStatus() {
            const statusIcon = document.getElementById('emailStatusIcon');
            const statusText = document.getElementById('emailStatus');

            // Simulate different status updates
            const statuses = [
                { icon: 'bi-hourglass-split', text: 'In elaborazione...', color: 'var(--vaitony-warning)' },
                { icon: 'bi-send', text: 'Invio in corso...', color: 'var(--vaitony-info)' },
                { icon: 'bi-check-circle-fill', text: 'Consegnata', color: 'var(--vaitony-success)' }
            ];

            const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];

            statusIcon.innerHTML = `<i class="bi ${randomStatus.icon}" style="color: ${randomStatus.color}; font-size: 1.2rem;"></i>`;
            statusText.textContent = randomStatus.text;
            statusText.style.color = randomStatus.color;
        }

        function addInteractiveEffects() {
            // Add hover effect to email card
            const emailCard = document.querySelector('[style*="background: linear-gradient(135deg, rgba(6, 182, 212, 0.05)"]');
            if (emailCard) {
                emailCard.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = 'var(--vaitony-shadow-xl)';
                });

                emailCard.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'var(--vaitony-success)',
                error: 'var(--vaitony-error)',
                info: 'var(--vaitony-info)'
            };

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--vaitony-radius-lg);
                box-shadow: var(--vaitony-shadow-xl);
                z-index: 1000;
                font-weight: 600;
                animation: slideInRight 0.5s ease-out;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes emailFloat {
                0%, 100% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-10px) rotate(5deg); }
            }

            @keyframes slideInDown {
                from { transform: translateY(-100%) translateX(-50%); opacity: 0; }
                to { transform: translateY(0) translateX(-50%); opacity: 1; }
            }

            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
{% endblock %}