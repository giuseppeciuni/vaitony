<!-- Profilo IA Tab -->
<div class="tab-pane fade" id="rag-config" role="tabpanel" aria-labelledby="rag-config-tab">
    <div class="row">
        <div class="col-lg-6 mb-4">
            <!-- Card Provider LLM e Engine -->
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-cpu me-2"></i>Motore IA del Progetto
                    </h5>
                </div>
                <div class="card-body">
                    {% if project.llm_config.engine %}
                        <div class="engine-info">
                            <div class="provider-logo">
                                {% if project.llm_config.engine.provider.logo %}
                                    <img src="{{ project.llm_config.engine.provider.logo.url }}"
                                         alt="{{ project.llm_config.engine.provider.name }}"
                                         style="max-height: 40px;">
                                {% else %}
                                    {% if project.llm_config.engine.provider.name == 'OpenAI' %}
                                        <i class="bi bi-cpu-fill fs-3" style="color: #10a37f;"></i>
                                    {% elif project.llm_config.engine.provider.name == 'Anthropic' %}
                                        <i class="bi bi-chat-square-heart-fill fs-3" style="color: #b83280;"></i>
                                    {% elif project.llm_config.engine.provider.name == 'Google' %}
                                        <i class="bi bi-google fs-3" style="color: #4285F4;"></i>
                                    {% elif project.llm_config.engine.provider.name == 'DeepSeek' %}
                                        <i class="bi bi-braces fs-3" style="color: #0066cc;"></i>
                                    {% else %}
                                        <i class="bi bi-robot fs-3" style="color: #6c757d;"></i>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <div>
                                <h6 class="mb-1">{{ project.llm_config.engine.provider.name }}</h6>
                                <h5 class="mb-0 text-primary">{{ project.llm_config.engine.name }}</h5>
                            </div>
                        </div>

                        <div class="mt-3">
                            <p class="text-muted mb-0">
                                {{ project.llm_config.engine.description }}
                            </p>
                        </div>

                        <hr>

                        <div class="config-params">
                            <h6 class="mb-3">Parametri Configurati</h6>
                            <div class="params-grid">
                                <div class="param-item">
                                    <div class="param-label">Temperatura</div>
                                    <div class="param-value">{{ project.llm_config.get_temperature }}</div>
                                </div>
                                <div class="param-item">
                                    <div class="param-label">Max Tokens</div>
                                    <div class="param-value">{{ project.llm_config.get_max_tokens }}</div>
                                </div>
                                <div class="param-item">
                                    <div class="param-label">Timeout</div>
                                    <div class="param-value">{{ project.llm_config.get_timeout }}s</div>
                                </div>
                                {% if project.llm_config.engine.supports_vision %}
                                <div class="param-item">
                                    <div class="param-label">Supporto Visione</div>
                                    <div class="param-value">
                                        <i class="bi bi-check-circle-fill text-success"></i> Attivo
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            Nessun motore IA configurato per questo progetto.
                        </div>
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent">
                    <a href="{% url 'project_config' project.id %}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-gear me-1"></i>Modifica Configurazione
                    </a>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <!-- Card Preset RAG Selezionato -->
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-search me-2"></i>Profilo RAG Attivo
                    </h5>
                </div>
                <div class="card-body">
                    {% if project.project_config.rag_preset %}
                        {% with preset=project.project_config.rag_preset %}
                        <div class="selected-preset-card
                            {% if preset.template_type.name == "Bilanciato" %}preset-balanced{% endif %}
                            {% if preset.template_type.name == "Alta Precisione" %}preset-high-precision{% endif %}
                            {% if preset.template_type.name == "Velocità" %}preset-speed{% endif %}
                            {% if preset.template_type.name == "Massima Precisione" %}preset-max-precision{% endif %}
                            {% if preset.template_type.name == "Massima Velocità" %}preset-max-speed{% endif %}
                            {% if preset.template_type.name == "Contesto Esteso" %}preset-extended-context{% endif %}">
                            <div class="selected-preset-header">
                                <span>{{ preset.name }}</span>
                                {% if preset.is_default %}
                                    <span class="badge-default">Default</span>
                                {% endif %}
                            </div>
                            <div class="selected-preset-body">
                                <p class="mb-3">
                                    {{ preset.description }}
                                </p>
                                <div class="selected-preset-specs">
                                    <div>
                                        <strong>Chunk Size</strong>
                                        <div>{{ preset.chunk_size }}</div>
                                    </div>
                                    <div>
                                        <strong>Overlap</strong>
                                        <div>{{ preset.chunk_overlap }}</div>
                                    </div>
                                    <div>
                                        <strong>Top K</strong>
                                        <div>{{ preset.similarity_top_k }}</div>
                                    </div>
                                    <div>
                                        <strong>Similarità</strong>
                                        <div>{{ preset.similarity_threshold }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="mt-4">
                            <h6 class="mb-3">Impostazioni RAG Avanzate</h6>
                            <div class="row g-3">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox"
                                               id="autoCitationCheck" disabled
                                               {% if preset.auto_citation %}checked{% endif %}>
                                        <label class="form-check-label" for="autoCitationCheck">
                                            Auto Citazione
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox"
                                               id="prioritizeFilenamesCheck" disabled
                                               {% if preset.prioritize_filenames %}checked{% endif %}>
                                        <label class="form-check-label" for="prioritizeFilenamesCheck">
                                            Priorità Nome File
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox"
                                               id="equalNotesWeightCheck" disabled
                                               {% if preset.equal_notes_weight %}checked{% endif %}>
                                        <label class="form-check-label" for="equalNotesWeightCheck">
                                            Note con Peso Uguale
                                        </label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox"
                                               id="strictContextCheck" disabled
                                               {% if preset.strict_context %}checked{% endif %}>
                                        <label class="form-check-label" for="strictContextCheck">
                                            Contesto Stretto
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endwith %}
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            Nessun profilo RAG configurato per questo progetto.
                        </div>
                    {% endif %}
                </div>
                <div class="card-footer bg-transparent">
                    <a href="{% url 'project_config' project.id %}" class="btn btn-outline-success btn-sm">
                        <i class="bi bi-gear me-1"></i>Modifica Configurazione
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Sezione Parametri RAG Personalizzati (se presenti) -->
    {% if customized_values %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-sliders me-2"></i>Parametri Personalizzati
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Questo progetto utilizza alcuni parametri personalizzati che sovrascrivono il preset selezionato.
                    </div>
                    <div class="params-grid">
                        {% if 'chunk_size' in customized_values %}
                        <div class="param-item">
                            <div class="param-label">Chunk Size <span class="customized-badge">Personalizzato</span></div>
                            <div class="param-value">{{ rag_values.chunk_size }}</div>
                        </div>
                        {% endif %}
                        {% if 'chunk_overlap' in customized_values %}
                        <div class="param-item">
                            <div class="param-label">Overlap <span class="customized-badge">Personalizzato</span></div>
                            <div class="param-value">{{ rag_values.chunk_overlap }}</div>
                        </div>
                        {% endif %}
                        {% if 'similarity_top_k' in customized_values %}
                        <div class="param-item">
                            <div class="param-label">Top K <span class="customized-badge">Personalizzato</span></div>
                            <div class="param-value">{{ rag_values.similarity_top_k }}</div>
                        </div>
                        {% endif %}
                        {% if 'similarity_threshold' in customized_values %}
                        <div class="param-item">
                            <div class="param-label">Threshold <span class="customized-badge">Personalizzato</span></div>
                            <div class="param-value">{{ rag_values.similarity_threshold }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>